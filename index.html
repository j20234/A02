<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ä¸“ä¸šçš„ä»»åŠ¡ç®¡ç†å·¥å…·ï¼ŒåŠ©ä½ è½»æ¾æŒæ§å·¥ä½œä¸ç”Ÿæ´»ã€‚æ”¯æŒå¤šè§†å›¾ã€æ•°æ®å¯¼å‡ºã€æš—é»‘æ¨¡å¼ç­‰åŠŸèƒ½ã€‚">
    <meta name="keywords" content="ä»»åŠ¡ç®¡ç†,todo,å¾…åŠäº‹é¡¹,ç”Ÿäº§åŠ›,GTD">
    <meta name="author" content="Task Management System">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ä»»åŠ¡ç®¡ç†">
    <title>ç»ˆæä»»åŠ¡ç®¡ç†ç³»ç»Ÿ - ä¼ä¸šçº§å®Œæ•´ç‰ˆ</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3EğŸ“‹%3C/text%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #5568d3;
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #f56565;
            --info: #4299e1;
            --bg-main: #f7fafc;
            --bg-card: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --border: #e2e8f0;
            --shadow: rgba(0,0,0,0.1);
        }

        body.dark-mode {
            --bg-main: #1a202c;
            --bg-card: #2d3748;
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --border: #4a5568;
            --shadow: rgba(0,0,0,0.3);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 25px;
            background: var(--bg-card);
            border-radius: 15px;
            box-shadow: 0 2px 10px var(--shadow);
            flex-wrap: wrap;
            gap: 15px;
        }

        .app-title {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .top-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .icon-btn {
            padding: 10px 15px;
            background: var(--bg-main);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .icon-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .header h1 {
            font-size: 36px;
            margin-bottom: 15px;
        }

        .header-subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 25px;
        }

        .header-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .stat-card {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 13px;
            opacity: 0.9;
        }

        .progress-section {
            margin-top: 20px;
        }

        .progress-bar {
            height: 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: white;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .view-switcher {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: var(--bg-card);
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 2px 10px var(--shadow);
            overflow-x: auto;
        }

        .view-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.2s;
            white-space: nowrap;
        }

        .view-btn:hover {
            background: var(--bg-main);
        }

        .view-btn.active {
            background: var(--primary);
            color: white;
        }

        .main-content {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            gap: 25px;
        }

        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 250px 1fr;
            }
            .analytics-panel {
                display: none;
            }
        }

        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .sidebar {
                order: 2;
            }
        }

        .sidebar, .analytics-panel {
            background: var(--bg-card);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 15px var(--shadow);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .sidebar h3, .analytics-panel h3 {
            margin-bottom: 20px;
            color: var(--primary);
            font-size: 17px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group {
            margin-bottom: 25px;
        }

        .filter-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 8px;
            background: transparent;
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 15px;
            color: var(--text-primary);
            text-align: left;
        }

        .filter-btn:hover {
            background: var(--bg-main);
            border-color: var(--border);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .filter-count {
            margin-left: auto;
            background: var(--bg-main);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            min-width: 30px;
            text-align: center;
        }

        .filter-btn.active .filter-count {
            background: rgba(255,255,255,0.25);
            color: white;
        }

        .chart-container {
            background: var(--bg-main);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .chart-bar {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-label {
            width: 90px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .chart-bar-bg {
            flex: 1;
            height: 30px;
            background: var(--border);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .chart-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--info));
            display: flex;
            align-items: center;
            padding: 0 12px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            transition: width 0.6s ease;
        }

        .productivity-score {
            text-align: center;
            padding: 25px;
            background: linear-gradient(135deg, var(--success) 0%, var(--info) 100%);
            color: white;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .score-number {
            font-size: 56px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .score-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .ai-suggestions {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .ai-suggestions h4 {
            margin-bottom: 15px;
            font-size: 15px;
        }

        .suggestion-item {
            background: rgba(255,255,255,0.15);
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .suggestion-item:hover {
            background: rgba(255,255,255,0.25);
            transform: translateX(5px);
        }

        .todo-section {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 15px var(--shadow);
        }

        .input-area {
            background: var(--bg-main);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid var(--border);
        }

        .input-row {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }

        .todo-input {
            flex: 1;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .todo-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .add-btn {
            padding: 16px 32px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .add-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .options-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }

        .select-input, .date-input, .time-input {
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background: var(--bg-card);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .select-input:focus, .date-input:focus, .time-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .textarea-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background: var(--bg-card);
            color: var(--text-primary);
            resize: vertical;
            min-height: 70px;
            margin-bottom: 15px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .textarea-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .tags-container {
            margin-bottom: 15px;
        }

        .tags-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
        }

        .tags-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--bg-card);
            min-height: 50px;
        }

        .tag {
            background: var(--primary);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            animation: tagIn 0.3s ease;
        }

        @keyframes tagIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .tag-remove {
            cursor: pointer;
            font-weight: bold;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .tag-remove:hover {
            opacity: 1;
        }

        .tag-input-field {
            border: none;
            outline: none;
            background: transparent;
            flex: 1;
            min-width: 120px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            max-width: 400px;
            padding: 12px 18px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 15px;
            background: var(--bg-card);
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .toolbar-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .sort-btn, .action-icon-btn {
            padding: 10px 16px;
            background: var(--bg-main);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-primary);
            transition: all 0.2s;
            font-weight: 500;
        }

        .sort-btn:hover, .action-icon-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .todo-list {
            list-style: none;
        }

        .todo-item {
            background: var(--bg-main);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 12px;
            transition: all 0.3s;
            border-left: 5px solid transparent;
            animation: slideIn 0.4s ease;
            cursor: pointer;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .todo-item:hover {
            box-shadow: 0 8px 25px var(--shadow);
            transform: translateX(8px);
        }

        .todo-item.priority-high {
            border-left-color: var(--danger);
            background: linear-gradient(90deg, rgba(245, 101, 101, 0.05) 0%, var(--bg-main) 20%);
        }

        .todo-item.priority-medium {
            border-left-color: var(--warning);
            background: linear-gradient(90deg, rgba(237, 137, 54, 0.05) 0%, var(--bg-main) 20%);
        }

        .todo-item.priority-low {
            border-left-color: var(--success);
            background: linear-gradient(90deg, rgba(72, 187, 120, 0.05) 0%, var(--bg-main) 20%);
        }

        .todo-item.completed {
            opacity: 0.65;
        }

        .todo-item.overdue {
            border: 2px solid var(--danger);
        }

        .todo-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 12px;
        }

        .todo-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
            margin-top: 2px;
            accent-color: var(--primary);
        }

        .todo-content {
            flex: 1;
        }

        .todo-text {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
            word-break: break-word;
        }

        .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .todo-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 12px;
            line-height: 1.6;
        }

        .todo-meta {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .meta-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            background: var(--bg-card);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .category-work {
            background: #bee3f8;
            color: #2c5282;
        }

        .category-personal {
            background: #fbb6ce;
            color: #97266d;
        }

        .category-study {
            background: #c6f6d5;
            color: #22543d;
        }

        .priority-high {
            background: #fed7d7;
            color: #c53030;
        }

        .priority-medium {
            background: #feebc8;
            color: #c05621;
        }

        .priority-low {
            background: #c6f6d5;
            color: #276749;
        }

        .tags-display {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .tag-display {
            background: var(--info);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .subtasks-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .subtask-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .subtask-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .add-subtask-btn {
            padding: 4px 10px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 11px;
            cursor: pointer;
        }

        .subtask-list {
            list-style: none;
        }

        .subtask-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            margin-bottom: 8px;
            background: var(--bg-card);
            border-radius: 8px;
            font-size: 14px;
        }

        .subtask-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .subtask-text {
            flex: 1;
        }

        .subtask-item.completed .subtask-text {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .subtask-delete {
            color: var(--danger);
            cursor: pointer;
            font-size: 12px;
        }

        .todo-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 5px;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .edit-btn {
            background: var(--info);
            color: white;
        }

        .share-btn {
            background: var(--success);
            color: white;
        }

        .duplicate-btn {
            background: var(--warning);
            color: white;
        }

        .delete-btn {
            background: var(--danger);
            color: white;
        }

        .action-btn:hover {
            opacity: 0.85;
            transform: scale(1.05);
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 100px;
            margin-bottom: 25px;
            opacity: 0.3;
        }

        .empty-title {
            font-size: 24px;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .empty-description {
            font-size: 16px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            padding: 35px;
            border-radius: 20px;
            max-width: 650px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .modal-title {
            font-size: 26px;
            font-weight: bold;
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 32px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .modal-close:hover {
            background: var(--bg-main);
            color: var(--danger);
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 15px;
        }

        .form-input {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 15px;
            background: var(--bg-card);
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .modal-btn {
            padding: 12px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: var(--bg-main);
            color: var(--text-primary);
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px var(--shadow);
        }

        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--success);
            color: white;
            padding: 18px 28px;
            border-radius: 12px;
            box-shadow: 0 8px 25px var(--shadow);
            z-index: 2000;
            animation: slideInRight 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 400px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(500px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.error {
            background: var(--danger);
        }

        .notification.warning {
            background: var(--warning);
        }

        .notification.info {
            background: var(--info);
        }

        .kanban-view {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .kanban-column {
            background: var(--bg-main);
            padding: 20px;
            border-radius: 15px;
            min-height: 400px;
        }

        .kanban-header {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .kanban-count {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
        }

        .calendar-view {
            background: var(--bg-card);
            padding: 25px;
            border-radius: 15px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-day {
            aspect-ratio: 1;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .calendar-day:hover {
            background: var(--primary);
            color: white;
        }

        .calendar-day.has-tasks {
            background: var(--info);
            color: white;
        }

        @media (max-width: 768px) {
            .kanban-view {
                grid-template-columns: 1fr;
            }

            .header-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .input-row {
                flex-direction: column;
            }

            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                max-width: 100%;
            }
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Scroll bar styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="app-title">ğŸ“‹ ç»ˆæä»»åŠ¡ç®¡ç†ç³»ç»Ÿ</div>
            <div class="top-actions">
                <button class="icon-btn" onclick="toggleDarkMode()" title="åˆ‡æ¢æš—é»‘æ¨¡å¼">ğŸŒ“ ä¸»é¢˜</button>
                <button class="icon-btn" onclick="exportData()" title="å¯¼å‡ºæ•°æ®">ğŸ“¥ å¯¼å‡º</button>
                <button class="icon-btn" onclick="importData()" title="å¯¼å…¥æ•°æ®">ğŸ“¤ å¯¼å…¥</button>
                <button class="icon-btn" onclick="showHelp()" title="å¸®åŠ©">â“ å¸®åŠ©</button>
            </div>
        </div>

        <!-- Header with Stats -->
        <div class="header">
            <h1>âœ¨ è®©æ¯ä¸€å¤©éƒ½é«˜æ•ˆæœ‰åº</h1>
            <div class="header-subtitle">ä¸“ä¸šçš„ä»»åŠ¡ç®¡ç†å·¥å…·ï¼ŒåŠ©ä½ è½»æ¾æŒæ§å·¥ä½œä¸ç”Ÿæ´»</div>
            
            <div class="header-stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalTasks">0</div>
                    <div class="stat-label">æ€»ä»»åŠ¡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedTasks">0</div>
                    <div class="stat-label">å·²å®Œæˆ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pendingTasks">0</div>
                    <div class="stat-label">è¿›è¡Œä¸­</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="overdueTasks">0</div>
                    <div class="stat-label">å·²é€¾æœŸ</div>
                </div>
            </div>

            <div class="progress-section">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>å®Œæˆè¿›åº¦</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- View Switcher -->
        <div class="view-switcher">
            <button class="view-btn active" onclick="switchView('list')" data-view="list">ğŸ“ åˆ—è¡¨è§†å›¾</button>
            <button class="view-btn" onclick="switchView('kanban')" data-view="kanban">ğŸ“Š çœ‹æ¿è§†å›¾</button>
            <button class="view-btn" onclick="switchView('calendar')" data-view="calendar">ğŸ“… æ—¥å†è§†å›¾</button>
            <button class="view-btn" onclick="switchView('timeline')" data-view="timeline">â±ï¸ æ—¶é—´çº¿</button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <h3>ğŸ” ç­›é€‰å™¨</h3>
                
                <div class="filter-group">
                    <button class="filter-btn active" onclick="filterByStatus('all')">
                        <span>ğŸ“‹</span>
                        <span>å…¨éƒ¨ä»»åŠ¡</span>
                        <span class="filter-count" id="countAll">0</span>
                    </button>
                    <button class="filter-btn" onclick="filterByStatus('pending')">
                        <span>â³</span>
                        <span>è¿›è¡Œä¸­</span>
                        <span class="filter-count" id="countPending">0</span>
                    </button>
                    <button class="filter-btn" onclick="filterByStatus('completed')">
                        <span>âœ…</span>
                        <span>å·²å®Œæˆ</span>
                        <span class="filter-count" id="countCompleted">0</span>
                    </button>
                    <button class="filter-btn" onclick="filterByStatus('overdue')">
                        <span>ğŸš¨</span>
                        <span>å·²é€¾æœŸ</span>
                        <span class="filter-count" id="countOverdue">0</span>
                    </button>
                </div>

                <h3 style="margin-top: 30px;">ğŸ“‚ åˆ†ç±»</h3>
                <div class="filter-group">
                    <button class="filter-btn" onclick="filterByCategory('work')">
                        <span>ğŸ’¼</span>
                        <span>å·¥ä½œ</span>
                        <span class="filter-count" id="countWork">0</span>
                    </button>
                    <button class="filter-btn" onclick="filterByCategory('personal')">
                        <span>ğŸ‘¤</span>
                        <span>ä¸ªäºº</span>
                        <span class="filter-count" id="countPersonal">0</span>
                    </button>
                    <button class="filter-btn" onclick="filterByCategory('study')">
                        <span>ğŸ“š</span>
                        <span>å­¦ä¹ </span>
                        <span class="filter-count" id="countStudy">0</span>
                    </button>
                </div>

                <h3 style="margin-top: 30px;">ğŸ¯ ä¼˜å…ˆçº§</h3>
                <div class="filter-group">
                    <button class="filter-btn" onclick="filterByPriority('high')">
                        <span>ğŸ”´</span>
                        <span>é«˜</span>
                        <span class="filter-count" id="countHigh">0</span>
                    </button>
                    <button class="filter-btn" onclick="filterByPriority('medium')">
                        <span>ğŸŸ¡</span>
                        <span>ä¸­</span>
                        <span class="filter-count" id="countMedium">0</span>
                    </button>
                    <button class="filter-btn" onclick="filterByPriority('low')">
                        <span>ğŸŸ¢</span>
                        <span>ä½</span>
                        <span class="filter-count" id="countLow">0</span>
                    </button>
                </div>
            </aside>

            <!-- Todo Section -->
            <main class="todo-section">
                <!-- Input Area -->
                <div class="input-area">
                    <div class="input-row">
                        <input type="text" id="todoInput" class="todo-input" placeholder="è¾“å…¥æ–°ä»»åŠ¡..." 
                               onkeypress="if(event.key==='Enter') addTodo()">
                        <button class="add-btn" onclick="addTodo()">â• æ·»åŠ ä»»åŠ¡</button>
                    </div>
                    
                    <div class="options-row">
                        <select id="categoryInput" class="select-input">
                            <option value="work">ğŸ’¼ å·¥ä½œ</option>
                            <option value="personal">ğŸ‘¤ ä¸ªäºº</option>
                            <option value="study">ğŸ“š å­¦ä¹ </option>
                        </select>
                        <select id="priorityInput" class="select-input">
                            <option value="low">ğŸŸ¢ ä½ä¼˜å…ˆçº§</option>
                            <option value="medium" selected>ğŸŸ¡ ä¸­ä¼˜å…ˆçº§</option>
                            <option value="high">ğŸ”´ é«˜ä¼˜å…ˆçº§</option>
                        </select>
                        <input type="date" id="dueDateInput" class="date-input">
                        <input type="time" id="dueTimeInput" class="time-input">
                    </div>

                    <textarea id="descriptionInput" class="textarea-input" placeholder="æ·»åŠ ä»»åŠ¡æè¿°ï¼ˆå¯é€‰ï¼‰..."></textarea>

                    <div class="tags-container">
                        <label class="tags-label">ğŸ·ï¸ æ ‡ç­¾</label>
                        <div class="tags-input" id="tagsContainer" onclick="focusTagInput()">
                            <input type="text" id="tagInput" class="tag-input-field" 
                                   placeholder="è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦..." 
                                   onkeypress="handleTagInput(event)">
                        </div>
                    </div>
                </div>

                <!-- Toolbar -->
                <div class="toolbar">
                    <input type="text" id="searchBox" class="search-box" 
                           placeholder="ğŸ” æœç´¢ä»»åŠ¡..." 
                           oninput="searchTodos()">
                    <div class="toolbar-actions">
                        <select id="sortSelect" class="sort-btn" onchange="sortTodos()">
                            <option value="newest">æœ€æ–°åˆ›å»º</option>
                            <option value="oldest">æœ€æ—©åˆ›å»º</option>
                            <option value="priority">ä¼˜å…ˆçº§</option>
                            <option value="dueDate">æˆªæ­¢æ—¥æœŸ</option>
                            <option value="alphabetical">å­—æ¯é¡ºåº</option>
                        </select>
                        <button class="action-icon-btn" onclick="clearCompleted()">ğŸ—‘ï¸ æ¸…é™¤å·²å®Œæˆ</button>
                        <button class="action-icon-btn" onclick="selectAll()">â˜‘ï¸ å…¨é€‰</button>
                    </div>
                </div>

                <!-- Todo List (List View) -->
                <div id="listView" class="list-view">
                    <ul id="todoList" class="todo-list"></ul>
                    <div id="emptyState" class="empty-state">
                        <div class="empty-icon">ğŸ“­</div>
                        <div class="empty-title">æš‚æ— ä»»åŠ¡</div>
                        <div class="empty-description">æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å¼€å§‹é«˜æ•ˆç®¡ç†å§ï¼</div>
                    </div>
                </div>

                <!-- Kanban View -->
                <div id="kanbanView" class="kanban-view" style="display: none;">
                    <div class="kanban-column">
                        <div class="kanban-header">
                            <span>â³ å¾…åŠ</span>
                            <span class="kanban-count" id="kanbanPendingCount">0</span>
                        </div>
                        <div id="kanbanPending"></div>
                    </div>
                    <div class="kanban-column">
                        <div class="kanban-header">
                            <span>ğŸ”„ è¿›è¡Œä¸­</span>
                            <span class="kanban-count" id="kanbanProgressCount">0</span>
                        </div>
                        <div id="kanbanProgress"></div>
                    </div>
                    <div class="kanban-column">
                        <div class="kanban-header">
                            <span>âœ… å·²å®Œæˆ</span>
                            <span class="kanban-count" id="kanbanCompletedCount">0</span>
                        </div>
                        <div id="kanbanCompleted"></div>
                    </div>
                </div>

                <!-- Calendar View -->
                <div id="calendarView" class="calendar-view" style="display: none;">
                    <div class="calendar-header">
                        <button class="icon-btn" onclick="previousMonth()">â—€ ä¸Šæœˆ</button>
                        <h3 id="calendarMonth">2025å¹´10æœˆ</h3>
                        <button class="icon-btn" onclick="nextMonth()">ä¸‹æœˆ â–¶</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>

                <!-- Timeline View -->
                <div id="timelineView" style="display: none;">
                    <div id="timelineContent"></div>
                </div>
            </main>

            <!-- Analytics Panel -->
            <aside class="analytics-panel">
                <h3>ğŸ“Š æ•°æ®åˆ†æ</h3>
                
                <div class="productivity-score">
                    <div class="score-number" id="productivityScore">85</div>
                    <div class="score-label">ç”Ÿäº§åŠ›è¯„åˆ†</div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">ğŸ“ˆ åˆ†ç±»ç»Ÿè®¡</div>
                    <div class="chart-bar">
                        <div class="chart-label">å·¥ä½œ</div>
                        <div class="chart-bar-bg">
                            <div class="chart-bar-fill" id="chartWork" style="width: 0%">0</div>
                        </div>
                    </div>
                    <div class="chart-bar">
                        <div class="chart-label">ä¸ªäºº</div>
                        <div class="chart-bar-bg">
                            <div class="chart-bar-fill" id="chartPersonal" style="width: 0%">0</div>
                        </div>
                    </div>
                    <div class="chart-bar">
                        <div class="chart-label">å­¦ä¹ </div>
                        <div class="chart-bar-bg">
                            <div class="chart-bar-fill" id="chartStudy" style="width: 0%">0</div>
                        </div>
                    </div>
                </div>

                <div class="ai-suggestions">
                    <h4>ğŸ’¡ æ™ºèƒ½å»ºè®®</h4>
                    <div class="suggestion-item" onclick="applyAISuggestion(1)">
                        ğŸ¯ å…ˆå®Œæˆé«˜ä¼˜å…ˆçº§ä»»åŠ¡
                    </div>
                    <div class="suggestion-item" onclick="applyAISuggestion(2)">
                        â° ä»Šå¤©æœ‰3ä¸ªä»»åŠ¡å³å°†åˆ°æœŸ
                    </div>
                    <div class="suggestion-item" onclick="applyAISuggestion(3)">
                        ğŸŒŸ å·²è¿ç»­å®Œæˆä»»åŠ¡5å¤©ï¼
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">â±ï¸ æœ¬å‘¨å®Œæˆè¶‹åŠ¿</div>
                    <div id="weeklyChart" style="height: 150px; display: flex; align-items: flex-end; gap: 10px; justify-content: space-around;">
                        <div style="flex: 1; background: var(--primary); border-radius: 5px; height: 60%;"></div>
                        <div style="flex: 1; background: var(--primary); border-radius: 5px; height: 80%;"></div>
                        <div style="flex: 1; background: var(--primary); border-radius: 5px; height: 40%;"></div>
                        <div style="flex: 1; background: var(--primary); border-radius: 5px; height: 90%;"></div>
                        <div style="flex: 1; background: var(--success); border-radius: 5px; height: 100%;"></div>
                        <div style="flex: 1; background: var(--border); border-radius: 5px; height: 20%;"></div>
                        <div style="flex: 1; background: var(--border); border-radius: 5px; height: 20%;"></div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">âœï¸ ç¼–è¾‘ä»»åŠ¡</h2>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">ä»»åŠ¡åç§°</label>
                <input type="text" id="editTodoText" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">ä»»åŠ¡æè¿°</label>
                <textarea id="editDescription" class="form-input" rows="4"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">åˆ†ç±»</label>
                <select id="editCategory" class="form-input">
                    <option value="work">ğŸ’¼ å·¥ä½œ</option>
                    <option value="personal">ğŸ‘¤ ä¸ªäºº</option>
                    <option value="study">ğŸ“š å­¦ä¹ </option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">ä¼˜å…ˆçº§</label>
                <select id="editPriority" class="form-input">
                    <option value="low">ğŸŸ¢ ä½ä¼˜å…ˆçº§</option>
                    <option value="medium">ğŸŸ¡ ä¸­ä¼˜å…ˆçº§</option>
                    <option value="high">ğŸ”´ é«˜ä¼˜å…ˆçº§</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">æˆªæ­¢æ—¥æœŸ</label>
                <input type="datetime-local" id="editDueDate" class="form-input">
            </div>
            <div class="modal-actions">
                <button class="modal-btn btn-secondary" onclick="closeEditModal()">å–æ¶ˆ</button>
                <button class="modal-btn btn-primary" onclick="saveEdit()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let todos = [];
        let currentFilter = 'all';
        let currentView = 'list';
        let editingId = null;
        let currentTags = [];
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadTodos();
            updateAllStats();
            renderTodos();
            initializeDates();
            checkDarkMode();
        });

        // Dark mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
            showNotification('ä¸»é¢˜å·²åˆ‡æ¢', 'info');
        }

        function checkDarkMode() {
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
            }
        }

        // Initialize dates
        function initializeDates() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dueDateInput').value = today;
            const now = new Date();
            document.getElementById('dueTimeInput').value = now.getHours().toString().padStart(2, '0') + ':' + 
                                                           now.getMinutes().toString().padStart(2, '0');
        }

        // Load todos from localStorage
        function loadTodos() {
            const saved = localStorage.getItem('todos');
            if (saved) {
                todos = JSON.parse(saved);
            }
        }

        // Save todos to localStorage
        function saveTodos() {
            localStorage.setItem('todos', JSON.stringify(todos));
        }

        // Add todo
        function addTodo() {
            const input = document.getElementById('todoInput');
            const text = input.value.trim();
            
            if (!text) {
                showNotification('è¯·è¾“å…¥ä»»åŠ¡å†…å®¹', 'warning');
                return;
            }

            const category = document.getElementById('categoryInput').value;
            const priority = document.getElementById('priorityInput').value;
            const dueDate = document.getElementById('dueDateInput').value;
            const dueTime = document.getElementById('dueTimeInput').value;
            const description = document.getElementById('descriptionInput').value.trim();

            const todo = {
                id: Date.now(),
                text: text,
                completed: false,
                category: category,
                priority: priority,
                dueDate: dueDate && dueTime ? `${dueDate}T${dueTime}` : '',
                description: description,
                tags: [...currentTags],
                subtasks: [],
                createdAt: new Date().toISOString()
            };

            todos.push(todo);
            saveTodos();
            
            input.value = '';
            document.getElementById('descriptionInput').value = '';
            currentTags = [];
            updateTagsDisplay();
            
            updateAllStats();
            renderTodos();
            showNotification('âœ… ä»»åŠ¡å·²æ·»åŠ ', 'success');
        }

        // Toggle todo completion
        function toggleTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                saveTodos();
                updateAllStats();
                renderTodos();
                
                if (todo.completed) {
                    showNotification('ğŸ‰ ä»»åŠ¡å·²å®Œæˆ', 'success');
                }
            }
        }

        // Delete todo
        function deleteTodo(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) {
                todos = todos.filter(t => t.id !== id);
                saveTodos();
                updateAllStats();
                renderTodos();
                showNotification('ğŸ—‘ï¸ ä»»åŠ¡å·²åˆ é™¤', 'info');
            }
        }

        // Edit todo
        function editTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (!todo) return;

            editingId = id;
            document.getElementById('editTodoText').value = todo.text;
            document.getElementById('editDescription').value = todo.description || '';
            document.getElementById('editCategory').value = todo.category;
            document.getElementById('editPriority').value = todo.priority;
            
            if (todo.dueDate) {
                document.getElementById('editDueDate').value = todo.dueDate.substring(0, 16);
            }

            document.getElementById('editModal').classList.add('active');
        }

        // Save edit
        function saveEdit() {
            const todo = todos.find(t => t.id === editingId);
            if (!todo) return;

            todo.text = document.getElementById('editTodoText').value.trim();
            todo.description = document.getElementById('editDescription').value.trim();
            todo.category = document.getElementById('editCategory').value;
            todo.priority = document.getElementById('editPriority').value;
            todo.dueDate = document.getElementById('editDueDate').value;

            saveTodos();
            closeEditModal();
            updateAllStats();
            renderTodos();
            showNotification('âœ… ä»»åŠ¡å·²æ›´æ–°', 'success');
        }

        // Close edit modal
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            editingId = null;
        }

        // Duplicate todo
        function duplicateTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (!todo) return;

            const newTodo = {
                ...todo,
                id: Date.now(),
                completed: false,
                text: todo.text + ' (å‰¯æœ¬)',
                createdAt: new Date().toISOString()
            };

            todos.push(newTodo);
            saveTodos();
            updateAllStats();
            renderTodos();
            showNotification('ğŸ“‹ ä»»åŠ¡å·²å¤åˆ¶', 'success');
        }

        // Share todo (copy to clipboard)
        function shareTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (!todo) return;

            const shareText = `ä»»åŠ¡: ${todo.text}\nåˆ†ç±»: ${todo.category}\nä¼˜å…ˆçº§: ${todo.priority}\n${todo.description ? 'æè¿°: ' + todo.description : ''}`;
            
            navigator.clipboard.writeText(shareText).then(() => {
                showNotification('ğŸ“‹ å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(() => {
                showNotification('å¤åˆ¶å¤±è´¥', 'error');
            });
        }

        // Render todos
        function renderTodos() {
            const filteredTodos = getFilteredTodos();
            const todoList = document.getElementById('todoList');
            const emptyState = document.getElementById('emptyState');

            if (currentView === 'list') {
                todoList.innerHTML = '';
                
                if (filteredTodos.length === 0) {
                    emptyState.style.display = 'block';
                } else {
                    emptyState.style.display = 'none';
                    filteredTodos.forEach(todo => {
                        todoList.appendChild(createTodoElement(todo));
                    });
                }
            } else if (currentView === 'kanban') {
                renderKanbanView();
            } else if (currentView === 'calendar') {
                renderCalendarView();
            } else if (currentView === 'timeline') {
                renderTimelineView();
            }
        }

        // Create todo element
        function createTodoElement(todo) {
            const li = document.createElement('li');
            li.className = `todo-item priority-${todo.priority}`;
            if (todo.completed) li.classList.add('completed');
            if (isOverdue(todo)) li.classList.add('overdue');

            const isOverdueFlag = isOverdue(todo);
            const dueDateStr = todo.dueDate ? new Date(todo.dueDate).toLocaleString('zh-CN') : '';

            li.innerHTML = `
                <div class="todo-header">
                    <input type="checkbox" class="todo-checkbox" 
                           ${todo.completed ? 'checked' : ''} 
                           onchange="toggleTodo(${todo.id})">
                    <div class="todo-content">
                        <div class="todo-text">${escapeHtml(todo.text)}</div>
                        ${todo.description ? `<div class="todo-description">${escapeHtml(todo.description)}</div>` : ''}
                        
                        <div class="todo-meta">
                            <span class="meta-badge category-${todo.category}">
                                ${getCategoryIcon(todo.category)} ${getCategoryName(todo.category)}
                            </span>
                            <span class="meta-badge priority-${todo.priority}">
                                ${getPriorityIcon(todo.priority)} ${getPriorityName(todo.priority)}
                            </span>
                            ${todo.dueDate ? `<span class="meta-badge ${isOverdueFlag ? 'priority-high' : ''}">
                                â° ${dueDateStr}
                            </span>` : ''}
                        </div>

                        ${todo.tags && todo.tags.length > 0 ? `
                            <div class="tags-display">
                                ${todo.tags.map(tag => `<span class="tag-display">#${escapeHtml(tag)}</span>`).join('')}
                            </div>
                        ` : ''}

                        <div class="todo-actions">
                            <button class="action-btn edit-btn" onclick="editTodo(${todo.id})">âœï¸ ç¼–è¾‘</button>
                            <button class="action-btn duplicate-btn" onclick="duplicateTodo(${todo.id})">ğŸ“‹ å¤åˆ¶</button>
                            <button class="action-btn share-btn" onclick="shareTodo(${todo.id})">ğŸ“¤ åˆ†äº«</button>
                            <button class="action-btn delete-btn" onclick="deleteTodo(${todo.id})">ğŸ—‘ï¸ åˆ é™¤</button>
                        </div>
                    </div>
                </div>
            `;

            return li;
        }

        // Helper functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function getCategoryIcon(category) {
            const icons = { work: 'ğŸ’¼', personal: 'ğŸ‘¤', study: 'ğŸ“š' };
            return icons[category] || 'ğŸ“‹';
        }

        function getCategoryName(category) {
            const names = { work: 'å·¥ä½œ', personal: 'ä¸ªäºº', study: 'å­¦ä¹ ' };
            return names[category] || category;
        }

        function getPriorityIcon(priority) {
            const icons = { high: 'ğŸ”´', medium: 'ğŸŸ¡', low: 'ğŸŸ¢' };
            return icons[priority] || 'âšª';
        }

        function getPriorityName(priority) {
            const names = { high: 'é«˜', medium: 'ä¸­', low: 'ä½' };
            return names[priority] || priority;
        }

        function isOverdue(todo) {
            if (!todo.dueDate || todo.completed) return false;
            return new Date(todo.dueDate) < new Date();
        }

        // Filter functions
        function filterByStatus(status) {
            currentFilter = status;
            updateFilterButtons();
            renderTodos();
        }

        function filterByCategory(category) {
            currentFilter = `category-${category}`;
            updateFilterButtons();
            renderTodos();
        }

        function filterByPriority(priority) {
            currentFilter = `priority-${priority}`;
            updateFilterButtons();
            renderTodos();
        }

        function updateFilterButtons() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        }

        function getFilteredTodos() {
            let filtered = [...todos];

            // Apply filter
            if (currentFilter === 'all') {
                // No filter
            } else if (currentFilter === 'completed') {
                filtered = filtered.filter(t => t.completed);
            } else if (currentFilter === 'pending') {
                filtered = filtered.filter(t => !t.completed);
            } else if (currentFilter === 'overdue') {
                filtered = filtered.filter(t => isOverdue(t));
            } else if (currentFilter.startsWith('category-')) {
                const category = currentFilter.replace('category-', '');
                filtered = filtered.filter(t => t.category === category);
            } else if (currentFilter.startsWith('priority-')) {
                const priority = currentFilter.replace('priority-', '');
                filtered = filtered.filter(t => t.priority === priority);
            }

            // Apply search
            const searchTerm = document.getElementById('searchBox')?.value?.toLowerCase() || '';
            if (searchTerm) {
                filtered = filtered.filter(t => 
                    t.text.toLowerCase().includes(searchTerm) ||
                    (t.description && t.description.toLowerCase().includes(searchTerm)) ||
                    (t.tags && t.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
                );
            }

            // Apply sort
            const sortBy = document.getElementById('sortSelect')?.value || 'newest';
            filtered.sort((a, b) => {
                switch (sortBy) {
                    case 'newest':
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    case 'oldest':
                        return new Date(a.createdAt) - new Date(b.createdAt);
                    case 'priority':
                        const priorityOrder = { high: 3, medium: 2, low: 1 };
                        return priorityOrder[b.priority] - priorityOrder[a.priority];
                    case 'dueDate':
                        if (!a.dueDate) return 1;
                        if (!b.dueDate) return -1;
                        return new Date(a.dueDate) - new Date(b.dueDate);
                    case 'alphabetical':
                        return a.text.localeCompare(b.text);
                    default:
                        return 0;
                }
            });

            return filtered;
        }

        // Search
        function searchTodos() {
            renderTodos();
        }

        // Sort
        function sortTodos() {
            renderTodos();
        }

        // Update statistics
        function updateAllStats() {
            const total = todos.length;
            const completed = todos.filter(t => t.completed).length;
            const pending = total - completed;
            const overdue = todos.filter(t => isOverdue(t)).length;

            document.getElementById('totalTasks').textContent = total;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('pendingTasks').textContent = pending;
            document.getElementById('overdueTasks').textContent = overdue;

            const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
            document.getElementById('progressPercent').textContent = progress + '%';
            document.getElementById('progressFill').style.width = progress + '%';

            // Update filter counts
            document.getElementById('countAll').textContent = total;
            document.getElementById('countPending').textContent = pending;
            document.getElementById('countCompleted').textContent = completed;
            document.getElementById('countOverdue').textContent = overdue;

            document.getElementById('countWork').textContent = todos.filter(t => t.category === 'work').length;
            document.getElementById('countPersonal').textContent = todos.filter(t => t.category === 'personal').length;
            document.getElementById('countStudy').textContent = todos.filter(t => t.category === 'study').length;

            document.getElementById('countHigh').textContent = todos.filter(t => t.priority === 'high').length;
            document.getElementById('countMedium').textContent = todos.filter(t => t.priority === 'medium').length;
            document.getElementById('countLow').textContent = todos.filter(t => t.priority === 'low').length;

            // Update charts
            updateCharts();

            // Update productivity score
            const score = calculateProductivityScore();
            document.getElementById('productivityScore').textContent = score;
        }

        // Update charts
        function updateCharts() {
            const workCount = todos.filter(t => t.category === 'work').length;
            const personalCount = todos.filter(t => t.category === 'personal').length;
            const studyCount = todos.filter(t => t.category === 'study').length;
            const maxCount = Math.max(workCount, personalCount, studyCount, 1);

            document.getElementById('chartWork').style.width = (workCount / maxCount * 100) + '%';
            document.getElementById('chartWork').textContent = workCount;
            document.getElementById('chartPersonal').style.width = (personalCount / maxCount * 100) + '%';
            document.getElementById('chartPersonal').textContent = personalCount;
            document.getElementById('chartStudy').style.width = (studyCount / maxCount * 100) + '%';
            document.getElementById('chartStudy').textContent = studyCount;
        }

        // Calculate productivity score
        function calculateProductivityScore() {
            if (todos.length === 0) return 0;
            
            const completedRatio = todos.filter(t => t.completed).length / todos.length;
            const onTimeRatio = todos.filter(t => !isOverdue(t)).length / todos.length;
            const score = Math.round((completedRatio * 0.7 + onTimeRatio * 0.3) * 100);
            
            return Math.max(0, Math.min(100, score));
        }

        // Tags handling
        function handleTagInput(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const input = e.target;
                const tag = input.value.trim();
                
                if (tag && !currentTags.includes(tag)) {
                    currentTags.push(tag);
                    updateTagsDisplay();
                    input.value = '';
                }
            }
        }

        function updateTagsDisplay() {
            const container = document.getElementById('tagsContainer');
            const input = document.getElementById('tagInput');
            
            // Remove all tags except input
            container.querySelectorAll('.tag').forEach(tag => tag.remove());
            
            // Add current tags
            currentTags.forEach((tag, index) => {
                const tagElement = document.createElement('span');
                tagElement.className = 'tag';
                tagElement.innerHTML = `
                    ${escapeHtml(tag)}
                    <span class="tag-remove" onclick="removeTag(${index})">Ã—</span>
                `;
                container.insertBefore(tagElement, input);
            });
        }

        function removeTag(index) {
            currentTags.splice(index, 1);
            updateTagsDisplay();
        }

        function focusTagInput() {
            document.getElementById('tagInput').focus();
        }

        // View switching
        function switchView(view) {
            currentView = view;
            
            // Update buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-view') === view) {
                    btn.classList.add('active');
                }
            });

            // Show/hide views
            document.getElementById('listView').style.display = view === 'list' ? 'block' : 'none';
            document.getElementById('kanbanView').style.display = view === 'kanban' ? 'grid' : 'none';
            document.getElementById('calendarView').style.display = view === 'calendar' ? 'block' : 'none';
            document.getElementById('timelineView').style.display = view === 'timeline' ? 'block' : 'none';

            renderTodos();
        }

        // Kanban view
        function renderKanbanView() {
            const pending = todos.filter(t => !t.completed && !isOverdue(t));
            const inProgress = todos.filter(t => !t.completed && isOverdue(t));
            const completed = todos.filter(t => t.completed);

            document.getElementById('kanbanPendingCount').textContent = pending.length;
            document.getElementById('kanbanProgressCount').textContent = inProgress.length;
            document.getElementById('kanbanCompletedCount').textContent = completed.length;

            document.getElementById('kanbanPending').innerHTML = pending.map(todo => 
                createTodoElement(todo).outerHTML
            ).join('');

            document.getElementById('kanbanProgress').innerHTML = inProgress.map(todo => 
                createTodoElement(todo).outerHTML
            ).join('');

            document.getElementById('kanbanCompleted').innerHTML = completed.map(todo => 
                createTodoElement(todo).outerHTML
            ).join('');
        }

        // Calendar view
        function renderCalendarView() {
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();

            document.getElementById('calendarMonth').textContent = 
                `${currentYear}å¹´${currentMonth + 1}æœˆ`;

            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            // Add day headers
            const dayNames = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            dayNames.forEach(day => {
                const header = document.createElement('div');
                header.style.textAlign = 'center';
                header.style.fontWeight = 'bold';
                header.style.padding = '10px';
                header.textContent = day;
                grid.appendChild(header);
            });

            // Add empty cells
            for (let i = 0; i < startingDayOfWeek; i++) {
                grid.appendChild(document.createElement('div'));
            }

            // Add day cells
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;

                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const tasksOnDay = todos.filter(t => t.dueDate && t.dueDate.startsWith(dateStr));

                if (tasksOnDay.length > 0) {
                    dayElement.classList.add('has-tasks');
                    dayElement.title = `${tasksOnDay.length} ä¸ªä»»åŠ¡`;
                }

                grid.appendChild(dayElement);
            }
        }

        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendarView();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendarView();
        }

        // Timeline view
        function renderTimelineView() {
            const sortedTodos = [...todos].sort((a, b) => {
                if (!a.dueDate) return 1;
                if (!b.dueDate) return -1;
                return new Date(a.dueDate) - new Date(b.dueDate);
            });

            const timeline = document.getElementById('timelineContent');
            timeline.innerHTML = sortedTodos.map(todo => 
                createTodoElement(todo).outerHTML
            ).join('');
        }

        // Utility functions
        function clearCompleted() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å·²å®Œæˆçš„ä»»åŠ¡å—ï¼Ÿ')) {
                todos = todos.filter(t => !t.completed);
                saveTodos();
                updateAllStats();
                renderTodos();
                showNotification('ğŸ—‘ï¸ å·²æ¸…é™¤å®Œæˆä»»åŠ¡', 'info');
            }
        }

        function selectAll() {
            const checkboxes = document.querySelectorAll('.todo-checkbox');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            
            checkboxes.forEach(cb => {
                cb.checked = !allChecked;
                const todoId = parseInt(cb.getAttribute('onchange').match(/\d+/)[0]);
                const todo = todos.find(t => t.id === todoId);
                if (todo) {
                    todo.completed = !allChecked;
                }
            });

            saveTodos();
            updateAllStats();
            renderTodos();
        }

        // Export/Import
        function exportData() {
            const dataStr = JSON.stringify(todos, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `todos-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('ğŸ“¥ æ•°æ®å·²å¯¼å‡º', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const imported = JSON.parse(event.target.result);
                        if (confirm(`ç¡®å®šè¦å¯¼å…¥ ${imported.length} ä¸ªä»»åŠ¡å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰æ•°æ®ã€‚`)) {
                            todos = imported;
                            saveTodos();
                            updateAllStats();
                            renderTodos();
                            showNotification('ğŸ“¤ æ•°æ®å·²å¯¼å…¥', 'success');
                        }
                    } catch (error) {
                        showNotification('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // AI suggestions (placeholder)
        function applyAISuggestion(suggestionId) {
            showNotification('ğŸ’¡ æ™ºèƒ½å»ºè®®åŠŸèƒ½å¼€å‘ä¸­...', 'info');
        }

        // Help
        function showHelp() {
            alert(`ğŸ“‹ ç»ˆæä»»åŠ¡ç®¡ç†ç³»ç»Ÿä½¿ç”¨æŒ‡å—

âœ¨ ä¸»è¦åŠŸèƒ½ï¼š
â€¢ æ·»åŠ ä»»åŠ¡ï¼šè¾“å…¥ä»»åŠ¡åç§°å¹¶è®¾ç½®åˆ†ç±»ã€ä¼˜å…ˆçº§ã€æˆªæ­¢æ—¶é—´
â€¢ ç¼–è¾‘ä»»åŠ¡ï¼šç‚¹å‡»ç¼–è¾‘æŒ‰é’®ä¿®æ”¹ä»»åŠ¡è¯¦æƒ…
â€¢ å®Œæˆä»»åŠ¡ï¼šå‹¾é€‰å¤é€‰æ¡†æ ‡è®°å®Œæˆ
â€¢ åˆ é™¤ä»»åŠ¡ï¼šç‚¹å‡»åˆ é™¤æŒ‰é’®ç§»é™¤ä»»åŠ¡
â€¢ æœç´¢ç­›é€‰ï¼šä½¿ç”¨æœç´¢æ¡†å’Œç­›é€‰å™¨å¿«é€Ÿæ‰¾åˆ°ä»»åŠ¡
â€¢ å¤šè§†å›¾ï¼šæ”¯æŒåˆ—è¡¨ã€çœ‹æ¿ã€æ—¥å†ã€æ—¶é—´çº¿å››ç§è§†å›¾
â€¢ æ•°æ®å¯¼å…¥å¯¼å‡ºï¼šå¤‡ä»½å’Œæ¢å¤ä½ çš„ä»»åŠ¡æ•°æ®
â€¢ æš—é»‘æ¨¡å¼ï¼šç‚¹å‡»ä¸»é¢˜æŒ‰é’®åˆ‡æ¢æ˜æš—ä¸»é¢˜

ğŸ’¡ å°æç¤ºï¼š
â€¢ æŒ‰ Enter é”®å¿«é€Ÿæ·»åŠ ä»»åŠ¡
â€¢ ä½¿ç”¨æ ‡ç­¾ç»„ç»‡ç›¸å…³ä»»åŠ¡
â€¢ å®šæœŸæŸ¥çœ‹æ•°æ®åˆ†æé¢æ¿äº†è§£å·¥ä½œæ•ˆç‡
â€¢ å¯¼å‡ºæ•°æ®ä»¥é˜²ä¸¢å¤±

ç¥ä½ å·¥ä½œé«˜æ•ˆï¼ğŸš€`);
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.4s reverse';
                setTimeout(() => {
                    notification.remove();
                }, 400);
            }, 3000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeEditModal();
            }
        };

        // Service Worker for PWA support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(() => {
                    // Service worker not available, ignore
                });
            });
        }
    </script>
</body>
</html>
